备忘录模式
===

## 1. 介绍
备忘录模式（Memento Pattern）又叫做快照模式（Snapshot Pattern）或Token模式，是对象的行为模式。备忘录对象是一个用来存储另外一个对象内部状态的快照的对象。备忘录模式的用意是在不破坏封装的条件下，将一个对象的状态捉住（或者说备份），这样以后就可以将该对象恢复到原先保存的状态。

## 2. 适用场景
1. 需要保存和恢复数据的相关状态场景。
2. 提供一个可回滚（rollback）的操作。
3. 需要监控的副本场景中。例如：监控一个对象的属性，但是监控又不应该作为系统的主业务来调用，它只是边缘应用，即使出现监控不准、错误报警也影响不大，因此一般的做法是备份一个主线程中的对象，然后由分析程序来分析。
4. 数据库连接的事务管理就是用的备忘录模式，想想看，如果你要实现一个JDBC驱动，你怎么来实现事务？还不是用备忘录模式嘛！
5. 所谓的数据库连接池技术实质上是一种高效管理备忘录的技术，连接池中的连接就是备忘录角色，而连接池管理者负责连接的管理。连接池中的连接并不是一成不变的，它们会因为使用而改变自己的状态，比如被使用了多少次、何时被使用、被谁使用等，这些信息都会被连接池管理者记录下来，这些信息构成了连接的备忘录。当用户需要使用连接时，可以向连接池请求，连接池会分析当前连接的使用情况，决定哪一个连接对象是最合适的，然后返回这个对象给用户使用，这个对象就是一个备忘录，用户使用完毕后，不用再返回给连接池，因为连接池已经记录了这个对象的使用情况，知道这个对象是否可用，如果不可用，连接池会自动回收这个对象，如果可用，连接池会保留这个对象，等待下一个请求。
6. Undo操作的时候，让被操作的对象恢复到最近一次的状态。

## 3. 角色介绍
1. Originator（发起人）：负责创建一个备忘录Memento，用以记录当前时刻它的内部状态，并可使用备忘录恢复内部状态。Originator可以根据需要决定Memento存储自己的哪些内部状态。
2. Memento（备忘录）：负责存储Originator对象的内部状态，并可防止Originator以外的其他对象访问备忘录Memento。备忘录有两个接口：Caretaker只能看到备忘录的窄接口，它只能将备忘录传递给其他对象。Originator却可看到备忘录的宽接口，允许它访问返回到先前状态所需的所有数据。
3. Caretaker（管理者）：负责备忘录Memento，不能对Memento的内容进行访问或者操作。
4. Client（客户端）：负责创建一个Originator对象，并设置Originator对象的状态。一旦Originator对象需要保存当前状态时，就通知Client对象，Client对象负责请求Originator提供一个Memento对象。然后Originator返回一个Memento对象给Client对象，Client对象将Memento对象存储起来。如果Client对象需要使用先前保存的状态时，就从Client对象获取一个Memento对象，然后请求Originator恢复到备忘录对象所记录的状态。
